---
title: "Making your research reproducible: <br>Documenting and automating your data analysis in R"
author: "Mine Çetinkaya-Rundel"
date: "January 11, 2016"
output:
  ioslides_presentation:
    highlight: pygments
    widescreen: yes
---

# Reproducibility: who cares?

## Science retracts gay marriage paper without agreement of lead author LaCour

- In May 2015 Science retracted a study of how canvassers can sway 
people's opinions about gay marriage published just 5 months ago.

- Science Editor-in-Chief Marcia McNutt: Original survey data not made 
available for independent reproduction of results. + Survey incentives 
misrepresented. + Sponsorship statement false.

- Two Berkeley grad students who attempted to replicate the study quickly 
discovered that the data must have been faked.

- Methods we'll discuss today can't prevent this, but they can make it 
easier to discover issues.

<font size="3">Source: http://news.sciencemag.org/policy/2015/05/science-retracts-gay-marriage-paper-without-lead-author-s-consent</font>


## Seizure study retracted after authors realize data got "terribly mixed"

From the authors of **Low Dose Lidocaine for Refractory Seizures in 
Preterm Neonates**:

*"The article has been retracted at the request of the authors. After 
carefully re-examining the data presented in the article, they identified 
that data of two different hospitals got terribly mixed. The published 
results cannot be reproduced in accordance with scientific and clinical 
correctness."*

<br><br><br><br>

<font size="3">Source: http://retractionwatch.com/2013/02/01/seizure-study-retracted-after-authors-realize-data-got-terribly-mixed/</font>


## Bad spreadsheet merge kills depression paper, quick fix resurrects it

- The authors informed the journal that the merge of lab results and other 
survey data used in the paper resulted in an error regarding the 
identification codes. Results of the analyses were based on the data set 
in which this error occurred. Further analyses established the results 
reported in this manuscript and interpretation of the data are not correct.

- **Original conclusion:** Lower levels of CSF IL-6 were associated with 
current depression and with future depression [...].

- **Revised conclusion:** Higher levels of CSF IL-6 and IL-8 were 
associated with current depression [...].

<font size="3">Source: http://retractionwatch.com/2014/07/01/bad-spreadsheet-merge-kills-depression-paper-quick-fix-resurrects-it/</font>


## Divorce study felled by a coding error gets a second chance

- **Original conclusion:** The risk of divorce in a heterosexual marriage increases when the wife falls ill, but not the husband. 

- **Corrected conclusion:** Based on the corrected analysis, we conclude that there are not gender differences in the relationship between gender, pooled illness onset, and divorce.

<br><br><br><br>

<font size="3">Source: http://retractionwatch.com/2015/09/10/divorce-study-felled-by-a-coding-error-gets-a-second-chance/#more-32151</font>

## Divorce study retraction: Editor's note

- "The research environment is fast-paced given the ethos to “publish or perish"."

- "[...] research is becoming increasingly complex, with greater calls for transdisciplinary collaborations, “big data,” and more sophisticated research questions and methods [...] data sets often have multiple files that require merging, change the wording of questions over time, provide incomplete codebooks, and have unclear and sometimes duplicative variables."

- "Given these issues, I would not be surprised if coding errors were fairly common, and that the ones discovered constitute only the "tip of the iceberg."

<br><br>

<font size="3">Source: http://retractionwatch.com/2015/09/10/divorce-study-felled-by-a-coding-error-gets-a-second-chance/#more-32151</font>


# Reproducibility: why should you care?

## Think back to every time...

>- The results in Table 1 don't seem to correspond to those in Figure 2.
>- In what order do I run these scripts?
>- Where did we get this data file?
>- Why did I omit those samples?
>- How did I make that figure?
>- "Your script is now giving an error."
>- "The attached is similar to the code we used."

<br><br>

<font size="3">Source: Karl Broman</font>

## 

<br><br><br><br>

Your closest collaborator is you six months ago, <br>
but you don’t reply to emails.
<br><br>
<font size="3">- Mark Holder</font>

<br><br><br>

# Reproducibility: how?

## Reproducibility checklist

- Are the tables and figures reproducible from the code and data?
- Does the code actually do what you think it does?
- In addition to what was done, is it clear *why* it was done? (e.g., how 
were parameter settings chosen?)
- Can the code be used for other data?
- Can you extend the code to do other things?

## Ambitious goal + many other concerns 

We need an environment where

- data, analysis, and results are tightly connected, or better yet, 
inseparable

- reproducibility is built in
    + the original data remains untouched
    + all data manipulations and analyses are inherently documented

- documentation is human readable and syntax is minimal


## Toolkit

<center>
![toolkit](img/toolkit.png)
</center>


## Outline

1. Scriptability $\rightarrow$ R

2. Literate programming $\rightarrow$ R Markdown

3. Version control $\rightarrow$ Git / GitHub

4. Other considerations


# 1. Scriptability

## Point-and-click vs. scripting

- Learning curve: Point-and-click software (supposedly) have shallower learning curves than scripting languages

- Documentation: At a minimum, your code documents your analysis
    + And you can do better with comments and README files

- Automation: Need to rerun your analysis with new/updated data? Just change the input file.

- Collaboration: Sharing your analysis is as easy as sharing your scripts

## Why R?

<div class="columns-2">
- Programming language for data analysis
- Free!
- Open source
- Widely used and supported across all disciplines
- Can be used on Windows, Mac OS X, or Linux

![RSplashScreen](img/RSplashScreen.png)
</div>


## Why not language X?

- There are a number of other great programming tools out there that can also be 
used to improve the reproducibility of your analysis

- The key is to use some type of language that will allow you to automate and 
document your analysis

- Once you master one language you'll probably find it easier to learn another


## Once in R

<div class="columns-2">
You could just type into the command prompt...

- ... but that doesn't help much with documentation

- ... but that doesn't help much with automation

![RSplash](img/RSplash.png)
</div>


## 2. Literate programming

## Donald Knuth "Literate Programming (1983)"

"Let us change our traditional attitude to the construction of programs: 
Instead of imagining that our main task is to instruct a *computer* what 
to do, let us concentrate rather on explaining to *human beings* what we 
want a computer to do."

"The practitioner of literate programming [...] strives for a program that 
is comprehensible because its concepts have been introduced in an order 
that is best for human understanding, using a mixture of formal and 
informal methods that reinforce each other."

- These ideas have been around for years!
- and tools for putting them to practice have also been around
- but they have never been as accessible as the current tools


## A better solution than just R

With RStudio you can combine your programming and your documentation

<div class="columns-2">
- RStudio gives you a single environment to combine your documentation and your
analysis
- It runs on top of R
- Gives you a bunch of really cool features that we'll explore throughout the
workshop

![RSplashScreen](img/RStudioSplash.png)
</div>


## What is Markdown?

- Markdown is a lightweight markup language for creating HTML (or XHTML) 
documents.

- Markup languages are designed to produce documents from human readable 
text (and annotations).

- Some of you may be familiar with LaTeX. This is another (less human 
friendly) markup language for creating pdf documents.

- Why I love Markdown:
    + Simple syntax means easy to learn and use.
    + Focus on **content**, rather than **coding** and debugging 
    **errors**.
    + Allows for easy web authoring.
    + Once you have the basics down, you can get fancy and add HTML,
    JavaScript, and CSS.
    

## What is R Markdown?

Well, it's R + Markdown

[demo]


# 3. Version control

# Parting remarks



## Parting remarks

- Everyone struggles with reproducibility and it is a hindrance to moving 
science forward

- Evan with a fairly simple analysis challenges were faced in four main areas:
organization, documentation, automation, and dissemination

- Over the two day workshop, data analysis tasks will become more complex as we 
gather more data and ask more complicated questions, so we need better tools and 
workflows to combat issues arising in these areas

## Two-pronged approach

<div class="columns-2">
\#1 
Adopt a reproducible research workflow

<br><br>

\#2
Train new researchers who don’t have any other workflow

![two prongs](img/two-pronged-fork.jpg)

</div>
